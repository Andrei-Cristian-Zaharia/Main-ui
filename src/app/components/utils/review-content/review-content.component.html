<div *ngIf="reviewType === 0" class="review-container">
    <div class="review-section-title">
        <h2>Reviews</h2>
        <div *ngIf="userLogged === true">
            <div *ngIf="newReviewPanelOpen === false && userAlreadyPosted == false">
                <button pButton pRipple type="button" icon="pi pi-plus" class="p-button-rounded review-add"
                        (click)="toggleCreateReviewWindow()"></button>
            </div>
            <div *ngIf="newReviewPanelOpen === true">
                <button pButton pRipple type="button" icon="pi pi-minus" class="p-button-rounded review-add"
                        (click)="toggleCreateReviewWindow()"></button>
            </div>
        </div>
    </div>
    <p-card *ngIf="insertNewReviewWindow === true">
        <ng-template pTemplate="header">
            <div class="review-header" id="newReview">
                <div>
                    <div class="review-title">
                            <textarea class="review-insert-title" rows="1" pInputTextarea [autoResize]="true"
                                      [(ngModel)]="title" placeholder="Title..."></textarea>
                    </div>
                </div>
                <rate class="review-rate" [value]="givenStars" [type]="rateType.rating" [imageSize]="35"
                      [readonly]="false" (selectedValue)="updateReviewRating($event)"
                      (contextmenu)="resetReviewRating($event)"></rate>
            </div>
        </ng-template>
        <textarea class="review-insert-content" rows="2" pInputTextarea [autoResize]="true"
                  [(ngModel)]="content"></textarea>
        <div class="review-submit" *ngIf="userAlreadyPosted === false">
            <p-button label="Submit" (onClick)="createReview()"></p-button>
        </div>
        <div class="review-submit" *ngIf="userAlreadyPosted === true">
            <p-button label="Edit" (onClick)="editReview()"></p-button>
        </div>
    </p-card>
    <div *ngFor="let review of reviews">
        <div class="review">
            <p-card class="review-card">
                <ng-template pTemplate="header">
                    <div class="review-header">
                        <div class="review-title">
                            <h2>{{ review.title }}</h2>
                            <p class="review-date"> {{ review.creationDate }} </p>
                        </div>
                        <rate class="review-rate" [imageSize]="rateImageSize" [readonly]="true" [value]="review.rating"
                              [type]="rateType.rating"/>
                    </div>
                </ng-template>

                <div class="review-display-content">
                    {{ review.text }}
                </div>

                <ng-template pTemplate="footer">
                    <div class="review-user">
                        <div style="display: flex;" *ngIf="review.person.username == user.username">
                            <img src="../../../../assets/delete.png" alt="" class="review-edit-delete"
                                 (click)="showDeleteDialog(review)">
                            <img src="../../../../assets/edit.png" alt="" class="review-edit-delete"
                                 (click)="editReviewOfUser(review)">
                        </div>
                        <img src="../../../../assets/person-icon.png" alt="">
                        <h3 class="review-author-text"
                            (click)="goToProfile(review.person.username)"> {{ review.person.username }}
                        </h3>
                    </div>
                </ng-template>
            </p-card>
        </div>
    </div>
</div>

<div *ngIf="reviewType === 1">
    <div class="review-container" *ngIf="reviews.length > 0; else noReviews">
        <div class="profile-section-title">
            <h2>Reviews</h2>
        </div>
        <div *ngFor="let review of reviews">
            <div class="review">
                <p-card class="review-card">
                    <ng-template pTemplate="header">
                        <div class="review-header">
                            <div class="review-title">
                                <h2>{{ review.title }}</h2>
                                <p class="review-date"> {{ review.creationDate }} </p>
                            </div>
                            <rate class="review-rate" [imageSize]="rateImageSize" [readonly]="true" [value]="review.rating"
                                  [type]="rateType.rating"/>
                        </div>
                    </ng-template>

                    <div class="review-display-content">
                        {{ review.text }}
                    </div>

                    <ng-template pTemplate="footer">
                        <div class="review-entity">
                            <div *ngIf="review.category == 'RECIPE'; else restaurantName">
                                <h3 class="review-author-text"
                                    (click)="goToRecipePage(review.entityName)">Recipe: {{ review.entityName }} </h3>
                            </div>
                            <ng-template #restaurantName>
                                <h3 class="review-author-text"
                                    (click)="goToRecipePage(review.entityName)">
                                    Restaurant: {{ review.entityName }} </h3>
                            </ng-template>
                        </div>
                    </ng-template>
                </p-card>
            </div>
        </div>
    </div>
    <ng-template #noReviews>
        <div class="profile-section-title">
            <h2>Reviews</h2>
            <h4 class="subtitle-not-found">There are no reviews to display.</h4>
        </div>
    </ng-template>
</div>

<p-dialog header="Confirm delete" [(visible)]="confirmDeleteDialog" [position]="'bottom'" [modal]="true"
          [style]="{width: '20vw'}"
          [draggable]="false" [resizable]="false">
    <p>Are you sure you want to delete this review ?</p>
    <ng-template pTemplate="footer">
        <p-button icon="pi pi-check" (click)="deleteReviewOfUser()" label="Sure" styleClass="p-button-text"></p-button>
        <p-button icon="pi pi-check" (click)="hideDeleteDialog()" label="Cancel" styleClass="p-button-text"></p-button>
    </ng-template>
</p-dialog>
